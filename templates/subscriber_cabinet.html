{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        {% include 'partials/subscriber_menu.html' %}
    </div>
    <div class="col-md-9">
        <h1 class="h3 mb-4">Главная страница</h1>

        <div class="row">
            <!-- Блок с информацией -->
            <div class="col-md-7">
                <div class="card">
                    <div class="card-header">
                        {{ subscriber.full_name }}
                    </div>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item"><strong>Адрес:</strong> {{ subscriber.address }}</li>
                        <li class="list-group-item"><strong>Телефон:</strong> {{ subscriber.phone_number }}</li>
                    </ul>
                </div>
            </div>
            <!-- Блок пополнения баланса -->
            <div class="col-md-5">
                <div class="card">
                    <div class="card-header">
                        Ваш баланс
                    </div>
                    <div class="card-body">
                        <h2 class="card-title text-center mb-3">
                            <span class="badge {% if subscriber.balance >= 0 %}bg-success{% else %}bg-danger{% endif %} fs-4">
                                {{ "%.2f"|format(subscriber.balance) }} BYN
                            </span>
                        </h2>
                        <form action="/subscriber/top-up" method="post">
                            <div class="input-group">
                                <input type="number" step="0.01" min="0.01" class="form-control" name="amount" placeholder="Сумма" required>
                                <button class="btn btn-primary" type="submit">Пополнить</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <h3 class="mt-5">Ваши договоры и услуги</h3>
        {% if contracts %}
            <table class="table table-hover">
                <thead>
                <tr>
                    <th>№ Договора</th><th>Услуга</th><th>Стоимость</th><th>Дата начала</th><th>Статус</th>
                </tr>
                </thead>
                <tbody>
                {% for contract in contracts %}
                    <tr>
                        <td>{{ contract.contract_id }}</td>
                        <td>{{ contract.service_name }}</td>
                        <td>{{ "%.2f"|format(contract.price) }} BYN/мес.</td>
                        <td>{{ contract.start_date.strftime('%d.%m.%Y') }}</td>
                        <td>
                            <span class="badge {% if contract.status == 'Активен' %}bg-success{% elif contract.status == 'Приостановлен' %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ contract.status }}
                            </span>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>У вас нет активных договоров.</p>
        {% endif %}
    </div>
</div>
{% endblock %}